# üõ°Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è Webhook Payload

## ‚úÖ **–ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!**

### üîí **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**

#### 1. **–ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- ‚úÖ Payload —è–≤–ª—è–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º
- ‚úÖ JSON –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç—Å—è

#### 2. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è**
- ‚úÖ `update_id` - —á–∏—Å–ª–æ >= 0
- ‚úÖ –•–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–∏–ø –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç

#### 3. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**
- ‚úÖ `message` - –æ–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ `edited_message` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ `channel_post` - –ø–æ—Å—Ç—ã –≤ –∫–∞–Ω–∞–ª–∞—Ö
- ‚úÖ `edited_channel_post` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã
- ‚úÖ `callback_query` - inline –∫–Ω–æ–ø–∫–∏
- ‚úÖ `inline_query` - inline –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ `chosen_inline_result` - –≤—ã–±—Ä–∞–Ω–Ω—ã–µ inline —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ `shipping_query` - –∑–∞–ø—Ä–æ—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚úÖ `pre_checkout_query` - –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞
- ‚úÖ `poll` - –æ–ø—Ä–æ—Å—ã
- ‚úÖ `poll_answer` - –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ–ø—Ä–æ—Å—ã
- ‚úÖ `my_chat_member` - –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞
- ‚úÖ `chat_member` - –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞
- ‚úÖ `chat_join_request` - –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ

#### 4. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π**
–î–ª—è `message` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
- ‚úÖ `message_id` - —á–∏—Å–ª–æ
- ‚úÖ `date` - timestamp
- ‚úÖ `from.id` - ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
- ‚úÖ `chat.id` - ID —á–∞—Ç–∞

#### 5. **–í–∞–ª–∏–¥–∞—Ü–∏—è callback_query**
- ‚úÖ `id` - —Å—Ç—Ä–æ–∫–∞
- ‚úÖ `from.id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 6. **–í–∞–ª–∏–¥–∞—Ü–∏—è inline_query**
- ‚úÖ `id` - —Å—Ç—Ä–æ–∫–∞
- ‚úÖ `from.id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `query` - —Å—Ç—Ä–æ–∫–∞ –∑–∞–ø—Ä–æ—Å–∞

## üö® **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

### **400 Bad Request** - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π payload
```json
{
  "error": "Invalid webhook payload",
  "details": "Missing or invalid update_id field"
}
```

### **–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
- `Update must be an object`
- `Missing or invalid update_id field`
- `Update must contain at least one valid update type`
- `Invalid message.message_id`
- `Invalid message.from.id`
- `Invalid callback_query.id`

## üìä **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **Production —Ä–µ–∂–∏–º:**
```
üì® –û–±—Ä–∞–±–æ—Ç–∫–∞ update 12345, —Ç–∏–ø: message
‚úÖ Update 12345 —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
```

### **Development —Ä–µ–∂–∏–º:**
```
üì® –û–±—Ä–∞–±–æ—Ç–∫–∞ update 12345, —Ç–∏–ø: message
üêõ Debug payload: { "update_id": 12345, ... }
‚úÖ Update 12345 —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
```

### **–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö:**
```
‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π Telegram update: Missing or invalid update_id field
üìã Update ID: –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
```

## üîß **–§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**

### `validateTelegramUpdate(update): string | null`
–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
- `null` - –µ—Å–ª–∏ update –≤–∞–ª–∏–¥–Ω—ã–π
- `string` - –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏

### `getUpdateType(update): string`
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø (`message`, `callback_query`, etc.)
- `unknown` –µ—Å–ª–∏ —Ç–∏–ø –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω

## üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

- ‚úÖ **–ù–µ –ª–æ–≥–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π payload –≤ production**
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç injection –∞—Ç–∞–∫–∏**
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç DoS —á–µ—Ä–µ–∑ –±–æ–ª—å—à–∏–µ payload**

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**

### **–í–∞–ª–∏–¥–Ω—ã–π webhook:**
```bash
curl -X POST https://–≤–∞—à-—Å–∞–π—Ç.netlify.app/.netlify/functions/bot \
  -H "Content-Type: application/json" \
  -d '{"update_id": 12345, "message": {"message_id": 1, "date": 1640995200, "from": {"id": 123}, "chat": {"id": 456}, "text": "Hello"}}'
```

### **–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π webhook:**
```bash
curl -X POST https://–≤–∞—à-—Å–∞–π—Ç.netlify.app/.netlify/functions/bot \
  -H "Content-Type: application/json" \
  -d '{"invalid": "data"}'
```

## üìà **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**

1. **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **üêõ –û—Ç–ª–∞–¥–∫–∞** - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
3. **üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
4. **‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –†–∞–Ω–Ω—è—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
5. **üõ°Ô∏è –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –ó–∞—â–∏—Ç–∞ –æ—Ç crash –∏–∑-–∑–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**Webhook —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â–µ–Ω –æ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!** ‚úÖ 